{% extends "home.html" %}
{% block content %}
<div class="container mt-4">
  <h2 class="text-center text-danger mb-4 animate__animated animate__fadeInDown">
     Track Your Ambulance
  </h2>

  {% if dispatch %}
    <div class="card shadow-lg p-4 animate__animated animate__fadeInUp">
      <h4 class="mb-3 text-primary">
        <h4 class="mb-3 text-dark d-flex align-items-center">
      <span class="me-2" style="font-size: 1.8rem; color: #f3972fff;">Ambulance Assigned</span>
    </h4>
      </h4>

      <p class="fs-5">
        <strong>Ambulance:</strong> 
        <span class="badge bg-info text-dark">{{ dispatch.ambulance.vehicle_number }}</span>
      </p>

      <p class="fs-5">
        <strong>Driver:</strong> 
        {{ dispatch.driver.firstname }} {{ dispatch.driver.lastname }}
      </p>

      <p class="fs-5">
        <strong>Status:</strong> 
        <span class="badge bg-warning text-dark">{{ dispatch.status|title }}</span>
      </p>

      <p class="fs-5">
        <strong>ETA:</strong> ‚è± ~{{ dispatch.eta_minutes }} minutes
      </p>

      <!-- Animated Map -->
      <div id="map" class="shadow" style="height: 350px; border-radius: 15px; animation: fadeIn 1.5s ease;"></div>
    </div>

    <!-- Google Map Script (only runs when dispatch exists) -->
    <script>
      function initMap() {
        var ambulance = {lat: {{ dispatch.ambulance_lat }}, lng: {{ dispatch.ambulance_lng }} };
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 14, center: ambulance
        });
        var marker = new google.maps.Marker({position: ambulance, map: map, title: "Ambulance"});
      }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBgd2a3G7AAGr0AJxNifqvuY6I-f1Tvjvo&callback=initMap"
    async defer></script>

  {% else %}
    <div class="alert alert-warning text-center animate__animated animate__fadeIn">
      No ambulance assigned yet. Please wait.
    </div>
  {% endif %}
</div>

<!-- Add Animate.css & Bootstrap Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<style>
  /* Custom subtle animation for map */
  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
  }
</style>
{% endblock %}
